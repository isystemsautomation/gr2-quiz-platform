<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editare Întrebare - GR2 Quiz Platform</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/app.css' %}">
</head>
<body>
    <header class="header">
        <div class="header-container">
            <a href="{% url 'dashboard' %}" class="header-logo">
                <img src="{% static 'img/logo.png' %}" alt="Siglă companie">
                <span class="header-logo-text">Platformă internă chestionare Electricieni – Grupa 2</span>
            </a>
            <nav class="header-nav">
                <a href="{% url 'dashboard' %}">Dashboard</a>
                <a href="{% url 'logout' %}">Logout</a>
            </nav>
        </div>
    </header>

    <div class="main-container">
        <div class="card">
            <h2 class="page-title">Editare Întrebare</h2>

            <div class="question-display">
                <p><strong>ID Întrebare:</strong> {{ question.qid }}</p>
                <p><strong>Disciplină:</strong> {{ question.get_subject_display }}</p>
                <p><strong>Bloc:</strong> {{ question.block_number }}</p>
                <p><strong>Întrebare:</strong> {{ question.text }}</p>
            </div>

            <form method="post" class="edit-form">
                {% csrf_token %}
                <input type="hidden" name="version" value="{{ version }}">

                <div class="form-group">
                    <label for="correct">Răspuns Corect:</label>
                    {% if question.correct and not user.is_superuser %}
                        <input type="text" value="{{ question.correct|upper }}" disabled>
                        <input type="hidden" name="correct" value="{{ question.correct }}">
                        <small>Răspuns actual: {{ question.correct|upper }}. Doar superuserii pot modifica răspunsuri existente.</small>
                    {% else %}
                        <select name="correct" id="correct" {% if not question.correct %}required{% endif %}>
                            <option value="">-- Selectează --</option>
                            <option value="a" {% if question.correct == 'a' %}selected{% endif %}>A</option>
                            <option value="b" {% if question.correct == 'b' %}selected{% endif %}>B</option>
                            <option value="c" {% if question.correct == 'c' %}selected{% endif %}>C</option>
                        </select>
                        {% if not question.correct %}
                            <small>Această întrebare nu are un răspuns corect. Te rugăm să completezi.</small>
                        {% endif %}
                    {% endif %}
                </div>

                <div class="form-group">
                    <label for="explanation">Explicație:</label>
                    {% if question.explanation and not user.is_superuser %}
                        <textarea rows="4" disabled>{{ question.explanation }}</textarea>
                        <input type="hidden" name="explanation" value="{{ question.explanation }}">
                        <small>Explicație există. Doar superuserii pot edita explicații existente.</small>
                    {% else %}
                        <textarea name="explanation" id="explanation" rows="4">{{ question.explanation }}</textarea>
                        {% if not question.explanation %}
                            <small>Această întrebare nu are explicație. Te rugăm să completezi.</small>
                        {% endif %}
                    {% endif %}
                </div>

                {% if user.is_superuser %}
                <div class="form-group">
                    <label for="image_base">Nume Imagine (opțional):</label>
                    <input type="text" name="image_base" id="image_base" value="{{ question.image_base }}" placeholder="ex: qe123 sau custom/qe123">
                    <small>Lasă gol pentru pattern implicit ({% if question.subject == 'electrotehnica' %}qe{% elif question.subject == 'legislatie-gr-2' %}ql{% elif question.subject == 'norme-tehnice-gr-2' %}qn{% endif %}{{ question.qid }}). Nume fără extensie.</small>
                </div>
                {% endif %}

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Salvează</button>
                    <a href="{% url 'block_take' question.subject question.block_number %}" class="btn btn-secondary">Anulează</a>
                </div>
            </form>
        </div>
    </div>
</body>
</html>
